<!DOCTYPE html>
<html>
<head>
    <title>WebRTC Video Stream</title>
</head>
<body>
    <video id="localVideo" autoplay playsinline></video>
    <script>
        let peerConnection = new RTCPeerConnection();
        let videoElement = document.getElementById('localVideo');

        async function startStream() {
            const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
            videoElement.srcObject = stream;
            return stream;
        }

        async function connect() {
            const stream = await startStream();
            stream.getTracks().forEach(track => peerConnection.addTrack(track, stream));

            const offer = await peerConnection.createOffer();
            await peerConnection.setLocalDescription(offer);

            const response = await fetch('http://localhost:5000/offer', {
                method: 'POST',
                body: JSON.stringify({ sdp: offer.sdp, type: offer.type }),
                headers: { 'Content-Type': 'application/json' }
            });

            const answer = await response.json();
            await peerConnection.setRemoteDescription(new RTCSessionDescription(answer));

            peerConnection.onicecandidate = (event) => {
                if (event.candidate) {
                    console.log("New ICE candidate:", event.candidate);
                }
            };
        }

        connect();
    </script>
</body>
</html>
